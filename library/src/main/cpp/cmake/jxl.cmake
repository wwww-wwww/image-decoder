include(ExternalProject)

cmake_policy(SET CMP0097 NEW)

ExternalProject_Add(ep_jxl
    GIT_REPOSITORY      https://github.com/libjxl/libjxl
    GIT_TAG             v0.11.0
    GIT_SUBMODULES      "third_party/skcms"
    DEPENDS ep_highway ep_brotli ep_little-cms
    CMAKE_ARGS
        ${EP_CMAKE_ARGS}
        -DJPEGXL_BUNDLE_LIBPNG=false
        -DJPEGXL_ENABLE_DOXYGEN=OFF
        -DJPEGXL_ENABLE_MANPAGES=OFF
        -DJPEGXL_ENABLE_EXAMPLES=OFF
        -DJPEGXL_ENABLE_SJPEG=OFF
        -DJPEGXL_ENABLE_OPENEXR=OFF
        -DJPEGXL_ENABLE_TRANSCODE_JPEG=OFF
        -DJPEGXL_ENABLE_TOOLS=OFF
        -DJPEGXL_ENABLE_BENCHMARK=OFF
        -DJPEGXL_ENABLE_JPEGLI=OFF
        -DJPEGXL_ENABLE_DEVTOOLS=OFF
        -DJPEGXL_FORCE_SYSTEM_HWY=ON
        -DJPEGXL_FORCE_SYSTEM_BROTLI=ON
        -DJPEGXL_FORCE_SYSTEM_LCMS2=ON
        -DJPEGXL_ENABLE_SKCMS=OFF
        -DBUILD_SHARED_LIBS=OFF
        # -DJPEGXL_ENABLE_JPEGLI=OFF
        # -DJPEGXL_ENABLE_JPEGLI_LIBJPEG=ON
        # -DJPEGXL_INSTALL_JPEGLI_LIBJPEG=ON

    USES_TERMINAL_DOWNLOAD true
    USES_TERMINAL_BUILD true
)
